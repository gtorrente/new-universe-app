[
  {
    "id": "horoscopo-dario",
    "type": "http in",
    "z": "horoscopo-flow",
    "name": "Horoscopo Dario",
    "url": "/horoscopo",
    "method": "GET",
    "upload": false,
    "swaggerDoc": "",
    "x": 120,
    "y": 100,
    "wires": [["processar-requisicao-diario"]]
  },
  {
    "id": "horoscopo-semanal",
    "type": "http in",
    "z": "horoscopo-flow",
    "name": "Horoscopo Semanal",
    "url": "/horoscopo-semanal",
    "method": "GET",
    "upload": false,
    "swaggerDoc": "",
    "x": 120,
    "y": 200,
    "wires": [["processar-requisicao-semanal"]]
  },
  {
    "id": "processar-requisicao-diario",
    "type": "function",
    "z": "horoscopo-flow",
    "name": "Processar Requisicao Diario",
    "func": "// C√ìDIGO PARA REQUISI√á√ÉO DI√ÅRIA\nconsole.log('üöÄ INICIANDO PROCESSAMENTO DI√ÅRIO...');\n\n// Fun√ß√£o para obter chave da semana atual\nfunction getWeekKey() {\n  const now = new Date();\n  const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));\n  const year = startOfWeek.getFullYear();\n  const weekNumber = Math.ceil((startOfWeek.getDate() + startOfWeek.getDay()) / 7);\n  return `${year}-W${weekNumber.toString().padStart(2, '0')}`;\n}\n\n// Extrair signo da requisi√ß√£o\nconst { sign } = msg.payload;\n\nconsole.log('üì• Payload recebido:', msg.payload);\nconsole.log('üì• Signo extra√≠do:', sign);\n\nif (!sign) {\n  console.error('‚ùå Signo n√£o especificado');\n  msg.payload = {\n    success: false,\n    error: \"Signo n√£o especificado\",\n    message: \"Par√¢metro 'sign' √© obrigat√≥rio\"\n  };\n  return msg;\n}\n\n// Gerar URL completa para hor√≥scopo di√°rio\nconst semana = getWeekKey();\nconst urlCompleta = `https://firestore.googleapis.com/v1/projects/tarot-universo-catia/databases/(default)/documents/horoscopos_semanais/${semana}/signos/${sign}`;\n\nconsole.log('üîç DEBUG: URL completa gerada (DI√ÅRIO):');\nconsole.log('  ', urlCompleta);\n\n// IMPORTANTE: Definir msg.url com a URL completa\nmsg.url = urlCompleta;\nmsg.method = 'GET';\nmsg.headers = {\n  'Content-Type': 'application/json'\n};\n\n// Armazenar informa√ß√µes adicionais\nmsg.isSemanal = false;\nmsg.signo = sign;\nmsg.semana = semana;\n\nconsole.log('‚úÖ DEBUG: Configura√ß√£o conclu√≠da (DI√ÅRIO)');\nconsole.log('  - msg.url:', msg.url);\nconsole.log('  - msg.method:', msg.method);\nconsole.log('  - msg.headers:', msg.headers);\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 320,
    "y": 100,
    "wires": [["http-request-diario"]]
  },
  {
    "id": "processar-requisicao-semanal",
    "type": "function",
    "z": "horoscopo-flow",
    "name": "Processar Requisicao Semanal",
    "func": "// C√ìDIGO PARA REQUISI√á√ÉO SEMANAL\nconsole.log('üöÄ INICIANDO PROCESSAMENTO SEMANAL...');\n\n// Fun√ß√£o para obter chave da semana atual\nfunction getWeekKey() {\n  const now = new Date();\n  const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));\n  const year = startOfWeek.getFullYear();\n  const weekNumber = Math.ceil((startOfWeek.getDate() + startOfWeek.getDay()) / 7);\n  return `${year}-W${weekNumber.toString().padStart(2, '0')}`;\n}\n\n// Extrair signo da requisi√ß√£o\nconst { sign } = msg.payload;\n\nconsole.log('üì• Payload recebido:', msg.payload);\nconsole.log('üì• Signo extra√≠do:', sign);\n\nif (!sign) {\n  console.error('‚ùå Signo n√£o especificado');\n  msg.payload = {\n    success: false,\n    error: \"Signo n√£o especificado\",\n    message: \"Par√¢metro 'sign' √© obrigat√≥rio\"\n  };\n  return msg;\n}\n\n// Gerar URL completa para hor√≥scopo semanal\nconst semana = getWeekKey();\nconst urlCompleta = `https://firestore.googleapis.com/v1/projects/tarot-universo-catia/databases/(default)/documents/horoscopos_semanais/${semana}/signos/${sign}`;\n\nconsole.log('üîç DEBUG: URL completa gerada (SEMANAL):');\nconsole.log('  ', urlCompleta);\n\n// IMPORTANTE: Definir msg.url com a URL completa\nmsg.url = urlCompleta;\nmsg.method = 'GET';\nmsg.headers = {\n  'Content-Type': 'application/json'\n};\n\n// Armazenar informa√ß√µes adicionais\nmsg.isSemanal = true;\nmsg.signo = sign;\nmsg.semana = semana;\n\nconsole.log('‚úÖ DEBUG: Configura√ß√£o conclu√≠da (SEMANAL)');\nconsole.log('  - msg.url:', msg.url);\nconsole.log('  - msg.method:', msg.method);\nconsole.log('  - msg.headers:', msg.headers);\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 320,
    "y": 200,
    "wires": [["http-request-semanal"]]
  },
  {
    "id": "http-request-diario",
    "type": "http request",
    "z": "horoscopo-flow",
    "name": "http request diario",
    "method": "GET",
    "ret": "obj",
    "paytoqs": "ignore",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "senderr": false,
    "x": 520,
    "y": 100,
    "wires": [["processar-resposta-diario"]]
  },
  {
    "id": "http-request-semanal",
    "type": "http request",
    "z": "horoscopo-flow",
    "name": "http request semanal",
    "method": "GET",
    "ret": "obj",
    "paytoqs": "ignore",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "authType": "",
    "senderr": false,
    "x": 520,
    "y": 200,
    "wires": [["processar-resposta-semanal"]]
  },
  {
    "id": "processar-resposta-diario",
    "type": "function",
    "z": "horoscopo-flow",
    "name": "Processar Resposta Diario",
    "func": "// C√ìDIGO PARA PROCESSAR RESPOSTA DI√ÅRIA DO FIREBASE\nconsole.log('üîÑ PROCESSANDO RESPOSTA DI√ÅRIA DO FIREBASE...');\n\n// Verificar se h√° resposta do HTTP Request\nif (!msg.payload) {\n  console.error('‚ùå Nenhuma resposta recebida');\n  msg.payload = {\n    success: false,\n    error: \"Nenhuma resposta do Firebase\",\n    message: \"Dados n√£o encontrados\"\n  };\n  return msg;\n}\n\nconsole.log('üì• Resposta recebida:', typeof msg.payload);\n\n// Verificar se √© uma resposta de erro\nif (msg.payload.error || msg.payload.success === false) {\n  console.error('‚ùå Erro na resposta:', msg.payload);\n  return msg;\n}\n\n// Verificar se √© uma resposta do Firebase\nif (msg.payload.fields) {\n  console.log('‚úÖ Resposta do Firebase detectada (DI√ÅRIO)');\n  \n  try {\n    // Processar dados do Firebase\n    const dados = msg.payload.fields;\n    \n    // Extrair dados do destaque\n    const destaque = dados.destaque?.mapValue?.fields || {};\n    const destaqueProcessado = {\n      titulo: destaque.titulo?.stringValue || \"Hor√≥scopo Di√°rio\",\n      mensagem: destaque.mensagem?.stringValue || \"Mensagem do dia\",\n      tema: destaque.tema?.stringValue || \"Geral\",\n      cor: destaque.cor?.stringValue || \"#8B5CF6\"\n    };\n    \n    // Extrair dados do dia espec√≠fico (segunda-feira como exemplo)\n    const segunda = dados.segunda?.mapValue?.fields || {};\n    const diaProcessado = {\n      tema: segunda.tema?.stringValue || \"Geral\",\n      trecho: segunda.trecho?.stringValue || \"Mensagem do dia\",\n      cor: segunda.cor?.stringValue || \"#8B5CF6\",\n      icone: segunda.icone?.stringValue || \"FaStar\"\n    };\n    \n    // Montar resposta final\n    const resposta = {\n      success: true,\n      data: {\n        destaque: destaqueProcessado,\n        dia: diaProcessado,\n        signo: msg.signo || \"aries\",\n        semana: msg.semana || \"2025-W04\"\n      }\n    };\n    \n    console.log('‚úÖ Dados di√°rios processados com sucesso:', resposta);\n    msg.payload = resposta;\n    \n  } catch (error) {\n    console.error('‚ùå Erro ao processar dados di√°rios:', error);\n    msg.payload = {\n      success: false,\n      error: \"Erro ao processar dados do Firebase\",\n      message: error.message\n    };\n  }\n  \n} else {\n  console.error('‚ùå Formato de resposta inv√°lido:', msg.payload);\n  msg.payload = {\n    success: false,\n    error: \"Formato de resposta inv√°lido\",\n    message: \"Dados n√£o est√£o no formato esperado\"\n  };\n}\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 720,
    "y": 100,
    "wires": [["resposta-horoscopo"]]
  },
  {
    "id": "processar-resposta-semanal",
    "type": "function",
    "z": "horoscopo-flow",
    "name": "Processar Resposta Semanal",
    "func": "// C√ìDIGO PARA PROCESSAR RESPOSTA SEMANAL DO FIREBASE\nconsole.log('üîÑ PROCESSANDO RESPOSTA SEMANAL DO FIREBASE...');\n\n// Verificar se h√° resposta do HTTP Request\nif (!msg.payload) {\n  console.error('‚ùå Nenhuma resposta recebida');\n  msg.payload = {\n    success: false,\n    error: \"Nenhuma resposta do Firebase\",\n    message: \"Dados n√£o encontrados\"\n  };\n  return msg;\n}\n\nconsole.log('üì• Resposta recebida:', typeof msg.payload);\n\n// Verificar se √© uma resposta de erro\nif (msg.payload.error || msg.payload.success === false) {\n  console.error('‚ùå Erro na resposta:', msg.payload);\n  return msg;\n}\n\n// Verificar se √© uma resposta do Firebase\nif (msg.payload.fields) {\n  console.log('‚úÖ Resposta do Firebase detectada (SEMANAL)');\n  \n  try {\n    // Processar dados do Firebase\n    const dados = msg.payload.fields;\n    \n    // Extrair dados do destaque\n    const destaque = dados.destaque?.mapValue?.fields || {};\n    const destaqueProcessado = {\n      titulo: destaque.titulo?.stringValue || \"Hor√≥scopo Semanal\",\n      mensagem: destaque.mensagem?.stringValue || \"Mensagem da semana\",\n      tema: destaque.tema?.stringValue || \"Geral\",\n      cor: destaque.cor?.stringValue || \"#8B5CF6\"\n    };\n    \n    // Extrair dados de todos os dias da semana\n    const diasSemana = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado', 'domingo'];\n    const semanaProcessada = {};\n    \n    diasSemana.forEach(dia => {\n      const diaData = dados[dia]?.mapValue?.fields || {};\n      semanaProcessada[dia] = {\n        tema: diaData.tema?.stringValue || \"Geral\",\n        trecho: diaData.trecho?.stringValue || \"Mensagem do dia\",\n        cor: diaData.cor?.stringValue || \"#8B5CF6\",\n        icone: diaData.icone?.stringValue || \"FaStar\"\n      };\n    });\n    \n    // Montar resposta final\n    const resposta = {\n      success: true,\n      data: {\n        destaque: destaqueProcessado,\n        semana: semanaProcessada,\n        signo: msg.signo || \"aries\",\n        semanaKey: msg.semana || \"2025-W04\"\n      }\n    };\n    \n    console.log('‚úÖ Dados semanais processados com sucesso:', resposta);\n    console.log('üìä Dias processados:', Object.keys(semanaProcessada));\n    msg.payload = resposta;\n    \n  } catch (error) {\n    console.error('‚ùå Erro ao processar dados semanais:', error);\n    msg.payload = {\n      success: false,\n      error: \"Erro ao processar dados do Firebase\",\n      message: error.message\n    };\n  }\n  \n} else {\n  console.error('‚ùå Formato de resposta inv√°lido:', msg.payload);\n  msg.payload = {\n    success: false,\n    error: \"Formato de resposta inv√°lido\",\n    message: \"Dados n√£o est√£o no formato esperado\"\n  };\n}\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 720,
    "y": 200,
    "wires": [["resposta-horoscopo-semanal"]]
  },
  {
    "id": "resposta-horoscopo",
    "type": "http response",
    "z": "horoscopo-flow",
    "name": "Resposta Hor√≥scopo",
    "statusCode": "200",
    "headers": {},
    "x": 920,
    "y": 100,
    "wires": []
  },
  {
    "id": "resposta-horoscopo-semanal",
    "type": "http response",
    "z": "horoscopo-flow",
    "name": "Resposta Horoscopo Semanal",
    "statusCode": "200",
    "headers": {},
    "x": 920,
    "y": 200,
    "wires": []
  }
] 